\begin{quantikz}
\lstick{$f$} \setwiretype{c} & \gategroup[3,steps=9,style={rounded
    corners,fill=blue!10,draw=blue!50, inner
    xsep=5pt},background]{} & & & & \ctrl{0} & \setwiretype{n} & & & & \\
\setwiretype{n} & & \lstick{$\ket{\mathbf{0}}$} & \setwiretype{q} \qwbundle{n} & \gate{H^{\otimes n}} & \gate[2][5em]{U_f}\gateinput{$x$}\gateoutput{$x$}\wire[u]{c} &\qwbundle{n} & \gate{U_h} & \gate{H^{\otimes n}} & \meter{} & \setwiretype{c} \rstick{$\mathbf{m}$} & \setwiretype{n} & \\
\setwiretype{n} & & \lstick{$\ket{\mathbf{0}}$} & \setwiretype{q} \qwbundle{n-1} & & \gateinput{$\mathbf{y}$}\gateoutput{$\mathbf{y}\oplus f(x)$} & \qwbundle{n-1} & \phantomgate{U_h} & \phantomgate{H^{\otimes n}} & \meter{} & \setwiretype{c} \rstick{$\mathbf{w}$} & \setwiretype{n} &
\end{quantikz}
